% !TEX root = ../main.tex

\chapter{Concluding Remarks}\label{ch:remarks}
We summarized the main findings, implications, and contributions of our research as follows. They highlight the key insights derived from the research.

\section{Enhancing ERC-20 Security and User Protection in DeFi}
The dominance of ERC-20 tokens in bridging decentralized and traditional financial systems motivated us to study their role in DeFi. Leveraged tokens (LVTs) were also examined due to their ERC-20 foundation and the complications they pose for users. While ERC-20 tokens and LVTs share the same DeFi ecosystem, their mechanics vary in complexity, highlighting the need for deeper research to understand how they affect user investments.

On one end of the spectrum, ERC-20 tokens are relatively simple—standardized units of value that can be sent, received, and traded with predictable behavior across smart contracts. On the other hand, LVTs introduce complexities that pose investment risks, especially for users who may not fully understand their mechanics. The common ground in studying both ERC-20 tokens and LVTs is ultimately user protection. We addressed this by (i) improving the security of ERC-20 tokens, (ii) helping users better navigate the intricate risks associated with LVTs, and (iii) proposing a new decentralized model to resolve current shortcomings in LVTs.

We resolved the \mwa by first explaining the attack and proposing criteria for an acceptable solution that is compatible with ERC-20 specifications. After evaluating ten proposed solutions, we concluded that none fully satisfied the constraints of the standard. Therefore, we proposed two new solutions where the second mitigates the attack while adhering to standard specifications. The additional required code consumes approximately 37\% more gas than a non-secure implementation, which we believe is acceptable for ensuring a secure ERC-20 token.

Resolving the \mwa raises question of what other vulnerabilities might threaten the security of the ERC-20 token and, more importantly, its holders. In this regard, we studied all known vulnerabilities and cross-check their relevance to ERC-20 token contracts. We systematized a set of 82 distinct vulnerabilities and best practices. We then utilized our newly acquired specialized domain knowledge to provide a new ERC-20 implementation, TokenHook, which is open source and freely available in both Vyper and Solidity.

TokenHook is positioned to increase software diversity: currently, no Vyper ERC-20 implementation is considered a reference implementation, and only one Solidity implementation is actively maintained (OpenZeppelin's~\cite{OpenZeppelin_Token}). Relative to this implementation, TokenHook has enhanced security properties and stronger compliance with best practices. Perhaps of independent interest, we reported on differences between Vyper and Solidity when implementing the same TokenHook contract. 

We also used TokenHook as a benchmark implementation to explore the completeness and precision of seven auditing tools that are widely used in industry to detect security vulnerabilities. We conclude that while these tools are better than nothing, they do not replace the role of a security expert in developing and reviewing smart contract code. All these efforts aim to support investors in reducing investment risk when interacting with DeFi platforms. Platforms that use TokenHook are protected from currently known risks and can focus on expanding ERC-20 capabilities.

\section{Exploring the Complex Mechanics and Risks of Leveraged Tokens}
LVTs offer a compelling case for study due to their unique role in amplifying financial positions within a decentralized framework. Inspired by leveraged ETFs (LETFs) in traditional finance, LVTs provide users with increased risk-reward exposure without the need for margin trading or complex collateral management.

Compared to ERC-20 tokens, LVTs introduce a much higher level of complexity. These tokens dynamically adjust their exposure to an underlying asset, involving intricate rebalancing mechanisms often triggered by market volatility. They are issued in three categories—centralized, decentralized, and hybrid—each responding differently to market conditions, which can affect user investments. For example, centralized LVTs may lack transparency, while decentralized and hybrid models could suffer from issues like liquidity constraints or technical inefficiencies, potentially impacting returns and increasing exposure to losses during volatile market conditions.

Users may be attracted to LVTs for their potential to amplify returns, but they often do not fully comprehend how these mechanisms work or how value can be lost even when the underlying asset remains stable. A common misconception involves volatility decay, where users assume the token merely multiplies asset movements, unaware that frequent rebalancing can erode value over time. This makes leveraged tokens a more nuanced and risk-prone financial instrument.

To clarify these aspects for both investors and LVT developers, we analyzed over 1,600 leveraged tokens from 10 issuers and revealed multiple shortcomings, including a lack of transparency, insufficient blockchain integration, deviations from stated leverage ratios, and susceptibility to front-running attacks. These issues arise from the absence of a standardized framework for LVTs, compromising their performance and market acceptance. Studying mechanics and dynamics of LVTs point to the same conclusion: investors expecting simple leveraged positions that ``just work'' are likely to be disappointed by leveraged tokens. LVTs require careful consideration of their unique characteristics, making them more suitable for experienced traders.

Moving LVTs on-chain could improve transparency regarding supply, transactions, and holders, while enabling self-custody. Front-running mitigation should be explored through randomized rebalancing or stealth trading (\eg iceberg orders). LVT algorithms should be adjusted to reduce deviations from stated leverage. These measures aim to better align LVTs with investor expectations.

\section{Addressing Technical and Economic Challenges in DeFi with TokenHook and LeverEdge}
To address LVT deficiencies, we review these shortcomings and explore potential solutions. Seven of ten deficiencies can be overcome by deploying the token on the blockchain. Therefore, decentralization should be considered as the primary approach, since the future centralized tokens is likely to suffer the same drawbacks. The remaining three issues relate to the functionality of the token itself, that can be addressed by optimizing internal algorithms. We then focus on on-chain LVTs, where some advances has already been seen. We further examine these tokens and assess the extent to which the identified issues are mitigated.

Even though there have been notable attempts to decentralize LVTs, a closer look at their functionality shows ongoing shortcomings that need to be addressed. In this regard, we propose LeverEdge, an on-chain solution utilizing a hybrid L1-L2 approach to mitigate challenges such as latency, scalability, and gas fees. To our knowledge, LeverEdge is the first design for LVTs that utilizes decentralized perpetual contracts instead of debt or synthetic positions. It tackles the shortcomings of existing centralized tokens and fixes issues in decentralized tokens.

In fact, LeverEdge has resulted in the completion of previous research by incorporating the security features of TokenHook and extending its ERC-20 functionality to resolve both technical and economic challenges in decentralized and centralized LVTs. It passes security checks and can serve as a reference model for implementing new LVTs or migrating current deployments. This ensures not only robust technical performance but also the protection of user investments and the security of LVT transfers. By enhancing security while interacting with DeFi platforms, LeverEdge mitigates risks and builds confidence for users, making their interaction with decentralized finance more secure and reliable.

\section{Summary of contributions}\label{sec:summary}
By offering solutions such as TokenHook and LeverEdge, this work enhanced user protection and strengthens the core infrastructure of DeFi, marking a valuable academic contribution. The advancements focus is on ERC-20 security and improvements in leveraged token design and functionality. These solutions provide better safeguards for retail investors by addressing issues like insufficient financial backing, transparency and unexpected return on investment. A summary of the contributions of this dissertation is listed follows.
\begin{enumerate}[label={\ref{sec:summary}.\arabic*},leftmargin=*]
	\item \textbf{Security Improvements for ERC-20 Tokens}: Conducting a thorough evaluation of the \mwa on ERC-20, that was opened since 2016. We propose two new solutions to mitigate the vulnerability. One solution fully adheres to the ERC-20 standard while effectively addressing the attack.

	\item \textbf{Systematization of ERC-20 Vulnerabilities}: The research systematizes 82 existing vulnerabilities specific to ERC-20 tokens and then proposes a new implementation, TokenHook, which enhances security features of ERC-20 tokens in both Vyper and Solidity. It is a fully compliant ERC-20 implementation that mitigates identified attacks.

	\item \textbf{Evaluation of Smart Contract Auditing Tools}: An analysis of seven static analysis tools for smart contracts identifies their limitations in detecting vulnerabilities specific to ERC-20 tokens. It then suggests areas for further improvement in auditing tools.

	\item \textbf{Identifying deficiencies of Leveraged Tokens (LVTs)}: An analysis of over 1,600 leveraged tokens uncovers deficiencies such as a lack of transparency, inadequate financial backing, and risks of front-running. It offers a deeper understanding of their mechanics and the impact on investment returns.

	\item \textbf{Proposing a New Decentralized LVT Model}: Analyzing 3 leveraged products used in LVTs for generating leverage on the blockchain. Moreover, we evaluated 6 decentralized LVTs to determine how effectively they address existing issues. We finally propose a fully decentralized design for LVTs, LeverEdge, utilizing a hybrid L1-L2 model on Ethereum. It addresses the identified shortcomings of existing LVTs and offers a reference model aimed to protect investors from unexpected losses.
\end{enumerate}

